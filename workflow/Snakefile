import sys
import pandas
import numpy

configfile: "config/config.yaml"
pepfile: "schemas/project_config.yaml"

database = config["database"]
outdir = config["outdir"]
threshold = config["threshold"]
blacklisting = config["blacklisting"]
debug = config["debug"]

sample_sheet = pep.sample_table

sample_grouped = sample_sheet.groupby("type")
reads_sheet = sample_grouped.get_group("Reads")
assembly_sheet = sample_grouped.get_group("Assembly")

rule link:
  input:
    expand("%s/tmp/{sample}.fasta" %outdir, sample = assembly_sheet["sample_name"].tolist()),
    expand("%s/tmp/{sample}_R1.fastq.gz" %outdir, sample = reads_sheet["sample_name"].tolist()),
    expand("%s/tmp/{sample}_R2.fastq.gz" %outdir, sample = reads_sheet["sample_name"].tolist())

rule all:
  input:
    serovar = "%s/serovar.tsv" %outdir

include: "rules/handle_samples.smk"
include: "rules/detect_serovars.smk"
include: "rules/summarise_serovars.smk"

