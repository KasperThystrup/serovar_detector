import sys
from glob import glob
from re import sub
from os.path import basename

configfile: "config/config.yaml"

database = config["database"]
sample_dir = config["sample_dir"]
outdir = config["outdir"]

threshold_id = config["threshold_id"]
threshold_cov = config["threshold_cov"]

debug = config["debug"]

mates = glob(pathname = "%s/*.fastq.gz" %sample_dir)

samples = {sub("_R\d[_\d+]*.fastq.gz", "", fn) for fn in [basename(mt) for mt in mates]}

if len(samples) < 1:
	sys.exit("fastq.gz files are missing!")


species = basename(database).replace("_", " ") #

rule all:
	input:
		serovar = "%s/Results/serovar.tsv" %outdir

include: "rules/detect_serovars.smk"
include: "rules/summarise_serovars.smk"
